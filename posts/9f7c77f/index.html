<!DOCTYPE html><html class="theme-next mist use-motion" lang="zh_CN"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4"><link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222"><meta name="keywords" content="mariadb,编译,"><link rel="alternate" href="/atom.xml" title="小叽の博客" type="application/atom+xml"><meta name="description" content="源码安装CMake"><meta name="keywords" content="mariadb,编译"><meta property="og:type" content="article"><meta property="og:title" content="源码编译安装mariadb数据库"><meta property="og:url" content="https://hexo.lilis.xin/posts/9f7c77f/index.html"><meta property="og:site_name" content="小叽の博客"><meta property="og:description" content="源码安装CMake"><meta property="og:locale" content="zh_CN"><meta property="og:updated_time" content="2019-09-12T06:27:03.599Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="源码编译安装mariadb数据库"><meta name="twitter:description" content="源码安装CMake"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Mist",version:"5.1.4",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:!1,onmobile:!1},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"Author"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="https://hexo.lilis.xin/posts/9f7c77f/"><title>源码编译安装mariadb数据库 | 小叽の博客</title></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh_CN"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">小叽の博客</span> <span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle"></p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>Home</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>Categories</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>Tags</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>Archives</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>About</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>Search</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i> </span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="Searching..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://hexo.lilis.xin/posts/9f7c77f/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="小叽"><meta itemprop="description" content><meta itemprop="image" content="https://lilis-hexo-blog.oss-cn-shenzhen.aliyuncs.com/head.png?x-oss-process=style/header"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="小叽の博客"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">源码编译安装mariadb数据库</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-07-18T10:06:00+08:00">2018-07-18</time></span><div class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i> </span><span class="post-meta-item-text">Words count in article&#58;</span> <span title="Words count in article">1.4k </span><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i> </span><span class="post-meta-item-text">Reading time &asymp;</span> <span title="Reading time">7</span></div></div></header><div class="post-body" itemprop="articleBody"><h2 id="源码安装CMake"><a href="#源码安装CMake" class="headerlink" title="源码安装CMake"></a>源码安装CMake</h2><a id="more"></a><h3 id="1-获取CMake源码包"><a href="#1-获取CMake源码包" class="headerlink" title="1.获取CMake源码包"></a>1.获取CMake源码包</h3><p><a href="https://cmake.org/files/v3.12/cmake-3.12.0.tar.gz" title="cmake-3.12.0.tar.gz" target="_blank" rel="noopener">cmake-3.12.0.tar.gz</a></p><h3 id="2-解压、编译、安装Cmake"><a href="#2-解压、编译、安装Cmake" class="headerlink" title="2.解压、编译、安装Cmake"></a>2.解压、编译、安装Cmake</h3><pre><code>tar -xzvf cmake-3.12.0.tar.gz
cd cmake-3.12.0
./bootstrap
make
make install
</code></pre><h3 id="备注"><a href="#备注" class="headerlink" title="备注"></a>备注</h3><p>cmake 会默认安装在 <code>usr/local/bin</code> 下面 <code>./bootstrap</code> 需要<code>gcc,gcc-c++</code>环境时</p><pre><code>yum install -y gcc gcc-c++
</code></pre><h2 id="源码安装mariadb"><a href="#源码安装mariadb" class="headerlink" title="源码安装mariadb"></a>源码安装mariadb</h2><h3 id="1-获取源码包"><a href="#1-获取源码包" class="headerlink" title="1.获取源码包"></a>1.获取源码包</h3><p><a href="https://downloads.mariadb.org/f/mariadb-10.3.8/source/mariadb-10.3.8.tar.gz/from/http%3A//ftp.utexas.edu/mariadb" title="mariadb-10.3.8.tar.gz" target="_blank" rel="noopener">mariadb-10.3.8.tar.gz</a></p><h3 id="2-编译环境准备"><a href="#2-编译环境准备" class="headerlink" title="2.编译环境准备"></a>2.编译环境准备</h3><pre><code>yum groupinstall -y Development Tools ncurses-devel openssl-devel openssl
</code></pre><h3 id="3-创建mysql用户"><a href="#3-创建mysql用户" class="headerlink" title="3.创建mysql用户"></a>3.创建mysql用户</h3><pre><code>groupadd mysql
useradd -s /sbin/nologin -g mysql -M mysql
id mysql
# uid=500(mysql) gid=500(mysql) groups=500(mysql)
#创建数据库数据存放目录；
mkdir /mydata/data -pv
chown mysql:mysql /mydata/data/ -R
</code></pre><h3 id="4-编译安装MariaDB"><a href="#4-编译安装MariaDB" class="headerlink" title="4.编译安装MariaDB"></a>4.编译安装MariaDB</h3><pre><code>cmake . -DCMAKE_INSTALL_PREFIX=/usr/local/mysql \
          -DMYSQL_DATADIR=/mydata/data \
          -DWITH_INNOBASE_STORAGE_ENGINE=1 \
          -DWITH_ARCHIVE_STORAGE_ENGINE=1 \
          -DWITH_BLACKHOLE_STORAGE_ENGINE=1 \
          -DWITH_READLINE=1 \
          -DWITH_SSL=system \
          -DWITH_ZLIB=system \
          -DWITH_LIBWRAP=0 \
          -DMYSQL_UNIX_ADDR=/tmp/mysql.sock \
          -DDEFAULT_CHARSET=utf8 \
          -DDEFAULT_COLLATION=utf8_general_ci
#编译完成后安装数据库：
make
make install
</code></pre><h3 id="5-配置安装MariaDB"><a href="#5-配置安装MariaDB" class="headerlink" title="5.配置安装MariaDB"></a>5.配置安装MariaDB</h3><pre><code>cd /usr/local/mysql/
scripts/mysql_install_db --user=mysql --datadir=/mydata/data
ls /mydata/data/
    aria_log.00000001  ib_logfile0  mysql-bin.000001  mysql-bin.state
    aria_log_control   ib_logfile1  mysql-bin.000002  performance_schema
    ibdata1            mysql        mysql-bin.index   test
</code></pre><h3 id="6-mariadb配置文件创建及更改，没有模版"><a href="#6-mariadb配置文件创建及更改，没有模版" class="headerlink" title="6.mariadb配置文件创建及更改，没有模版"></a>6.mariadb配置文件创建及更改，没有模版</h3><pre><code>mkdir /etc/mysql
vim /etc/mysql/my.cnf
    [mysqld]
    port            = 3306
    datadir         = /mydata/data
    socket          = /tmp/mysql.sock
    skip-external-locking
    key_buffer_size = 256M
    max_allowed_packet = 1M
    table_open_cache = 256
    sort_buffer_size = 1M
    read_buffer_size = 1M
    read_rnd_buffer_size = 4M
    myisam_sort_buffer_size = 64M
    thread_cache_size = 8
    query_cache_size= 16M
    # Try number of CPU&apos;s*2 for thread_concurrency
    thread_concurrency = 8
    innodb_file_per_table = on
    skip_name_resolve = on
</code></pre><p>创建服务脚本：</p><pre><code>cp support-files/mysql.server /etc/rc.d/init.d/mysqld
chkconfig --list mysqld
chkconfig --add mysqld
</code></pre><p>启动mysqld服务,测试启动</p><pre><code>service mysqld start
    Starting MySQL.                                            [  OK  ]
</code></pre><h3 id="7-设置环境变量"><a href="#7-设置环境变量" class="headerlink" title="7.设置环境变量"></a>7.设置环境变量</h3><pre><code>vim /etc/profile.d/mysqld.sh
    MYSQL_HOME=/usr/local/mysql
    export PATH=$MYSQL_HOME/bin:$PATH
</code></pre><h4 id="加载环境变量："><a href="#加载环境变量：" class="headerlink" title="加载环境变量："></a>加载环境变量：</h4><pre><code>source /etc/profile.d/mysqld.sh
</code></pre><h3 id="8-修改Mysql的root用户密码以及打开远程连接-可选"><a href="#8-修改Mysql的root用户密码以及打开远程连接-可选" class="headerlink" title="8.修改Mysql的root用户密码以及打开远程连接(可选)"></a>8.修改Mysql的root用户密码以及打开远程连接(可选)</h3><pre><code>mysql
    Welcome to the MariaDB monitor.  Commands end with ; or \g.
    Your MariaDB connection id is 9
    Server version: 10.3.8-MariaDB Source distribution

    Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.

    Type &apos;help;&apos; or &apos;\h&apos; for help. Type &apos;\c&apos; to clear the current input statement.
grant all privileges on *.* to root@&apos;localhost&apos; identified by &apos;密码&apos;;
grant all privileges on *.* to root@&apos;127.0.0.1&apos; identified by &apos;密码&apos;;
use mysql;
    Database changed
update user set password = password(&apos;密码&apos;) where User=&apos;root&apos;;
select Host,User,Password from user where User=&apos;root&apos;;
    +----------------+------+-------------------------------------------+
    | Host           | User | Password                                  |
    +----------------+------+-------------------------------------------+
    | localhost      | root | *密码                                     |
    | tom2.stu31.com | root | *密码                                     |
    | 127.0.0.1      | root | *密码                                     |
    | ::1            | root | *密码                                     |
    +----------------+------+-------------------------------------------+
    4 rows in set (0.00 sec)
</code></pre><h3 id="9-我们使用MariaDB提供的安全设置脚本来进行数据库安全配置"><a href="#9-我们使用MariaDB提供的安全设置脚本来进行数据库安全配置" class="headerlink" title="9.我们使用MariaDB提供的安全设置脚本来进行数据库安全配置"></a>9.我们使用MariaDB提供的安全设置脚本来进行数据库安全配置</h3><h4 id="MariaDB提供了一些配置脚本在"><a href="#MariaDB提供了一些配置脚本在" class="headerlink" title="MariaDB提供了一些配置脚本在"></a>MariaDB提供了一些配置脚本在</h4><pre><code>cd $MYSQL_HOME/bin
ls
    aria_chk       innochecksum    myisamchk          myrocks_hotbackup  mysqlcheck                  mysqld_multi        mysql_find_rows       mysql_plugin               mysqltest            perror              tokuftdump             wsrep_sst_rsync
    aria_dump_log  mariabackup     myisam_ftdump      mysql              mysql_client_test           mysqld_safe         mysql_fix_extensions  mysql_secure_installation  mysql_tzinfo_to_sql  replace             tokuft_logprint        wsrep_sst_rsync_wan
    aria_ftdump    mariadb_config  myisamlog          mysqlaccess        mysql_config                mysqld_safe_helper  mysqlhotcopy          mysql_setpermission        mysql_upgrade        resolveip           wsrep_sst_common       wsrep_sst_xtrabackup
    aria_pack      mbstream        myisampack         mysqladmin         mysql_convert_table_format  mysqldump           mysqlimport           mysqlshow                  mysql_waitpid        resolve_stack_dump  wsrep_sst_mariabackup  wsrep_sst_xtrabackup-v2
    aria_read_log  msql2mysql      my_print_defaults  mysqlbinlog        mysqld                      mysqldumpslow       mysql_ldb             mysqlslap                  mytop                sst_dump            wsrep_sst_mysqldump
#我们使用mysql_secure_installation这个脚本来进行安全配置：
mysql_secure_installation
    NOTE: RUNNING ALL PARTS OF THIS SCRIPT IS RECOMMENDED FOR ALL MariaDB
          SERVERS IN PRODUCTION USE!  PLEASE READ EACH STEP CAREFULLY!

    In order to log into MariaDB to secure it, we&apos;ll need the current
    password for the root user.  If you&apos;ve just installed MariaDB, and
    you haven&apos;t set the root password yet, the password will be blank,
    so you should just press enter here.

    Enter current password for root (enter for none): 
    OK, successfully used password, moving on...

    Setting the root password ensures that nobody can log into the MariaDB
    root user without the proper authorisation.

    Set root password? [Y/n] n    
     ... skipping.

    By default, a MariaDB installation has an anonymous user, allowing anyone
    to log into MariaDB without having to have a user account created for
    them.  This is intended only for testing, and to make the installation
    go a bit smoother.  You should remove them before moving into a
    production environment.

    Remove anonymous users? [Y/n] Y
     ... Success!

    Normally, root should only be allowed to connect from &apos;localhost&apos;.  This
    ensures that someone cannot guess at the root password from the network.

    Disallow root login remotely? [Y/n] Y
     ... Success!

    By default, MariaDB comes with a database named &apos;test&apos; that anyone can
    access.  This is also intended only for testing, and should be removed
    before moving into a production environment.

    Remove test database and access to it? [Y/n] Y
     - Dropping test database...
     ... Success!
     - Removing privileges on test database...
     ... Success!

    Reloading the privilege tables will ensure that all changes made so far
    will take effect immediately.

    Reload privilege tables now? [Y/n] Y
     ... Success!

    Cleaning up...

    All done!  If you&apos;ve completed all of the above steps, your MariaDB
    installation should now be secure.

    Thanks for using MariaDB!
#安全设置数据库完成后我们就不能使用mysql登录数据库了；但是平常我们操作时使用mysql -u root -p这样太麻烦了，为了方便，我们可以在用户家目录创建一个拥有mysql用户名和密码的.my.cnf隐藏配置文件进行登录数据库;
#创建个隐藏文件在root家目录：
vim .my.cnf
    [mysql]
    user = root
    password = 密码
    host =  127.0.0.1
</code></pre><h3 id="备注-1"><a href="#备注-1" class="headerlink" title="备注"></a>备注</h3><h4 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h4><p>重新编译时，需要清除旧的对象文件和缓存信息。</p><pre><code>make clean
rm -f CMakeCache.txt
rm -rf /etc/my.cnf
</code></pre><p>错误：<code>Curses library not found. Please install appropriate package</code> 解决方案： 先安装 <code>ncurses-devel</code> 包</p><pre><code>yum install ncurses-devel
</code></pre><p>再删除刚才编译生成的 <code>CMakeCache.txt</code> 文件</p><pre><code>rm CMakeCache.txt
</code></pre><p>再次执行一次<code>cmake</code></p><h4 id="编译选项"><a href="#编译选项" class="headerlink" title="编译选项"></a>编译选项</h4><pre><code>-DCMAKE_INSTALL_PREFIX=/usr/local/mysql       //安装目录
-DINSTALL_DATADIR=/mydata/data                //数据库存放目录
-DDEFAULT_CHARSET=utf8                    　　//使用utf8字符
-DDEFAULT_COLLATION=utf8_general_ci           //校验字符
-DEXTRA_CHARSETS=all                        　//安装所有扩展字符集
-DENABLED_LOCAL_INFILE=1                    　//允许从本地导入数据
</code></pre><h4 id="cmake编译指令介绍"><a href="#cmake编译指令介绍" class="headerlink" title="cmake编译指令介绍"></a>cmake编译指令介绍</h4><p>指定安装文件的安装路径时常用的选项：</p><pre><code>-DCMAKE_INSTALL_PREFIX=/usr/local/mysql
-DMYSQL_DATADIR=/mydata/data
-DSYSCONFDIR=/etc
</code></pre><p>默认编译的存储引擎包括：csv、myisam、myisammrg和heap。若要安装其它存储引擎，可以使用类似如下编译选项：</p><pre><code>-DWITH_INNOBASE_STORAGE_ENGINE=1
-DWITH_ARCHIVE_STORAGE_ENGINE=1
-DWITH_BLACKHOLE_STORAGE_ENGINE=1
-DWITH_FEDERATED_STORAGE_ENGINE=1
</code></pre><p>若要明确指定不编译某存储引擎，可以使用类似如下的选项：</p><pre><code>-DWITHOUT_&lt;ENGINE&gt;_STORAGE_ENGINE=1
#比如：
-DWITHOUT_EXAMPLE_STORAGE_ENGINE=1
-DWITHOUT_FEDERATED_STORAGE_ENGINE=1
-DWITHOUT_PARTITION_STORAGE_ENGINE=1
</code></pre><p>如若要编译进其它功能，如SSL等，则可使用类似如下选项来实现编译时使用某库或不使用某库：</p><pre><code>-DWITH_READLINE=1
-DWITH_SSL=system
-DWITH_ZLIB=system
-DWITH_LIBWRAP=0
</code></pre><p>其它常用的选项：</p><pre><code>-DMYSQL_TCP_PORT=3306
-DMYSQL_UNIX_ADDR=/tmp/mysql.sock
-DENABLED_LOCAL_INFILE=1
-DEXTRA_CHARSETS=all
-DDEFAULT_CHARSET=utf8
-DDEFAULT_COLLATION=utf8_general_ci
-DWITH_DEBUG=0
-DENABLE_PROFILING=1
</code></pre><p>如果想清理此前的编译所生成的文件，则需要使用如下命令：</p><pre><code>make clean
rm CMakeCache.txt
</code></pre></div><footer class="post-footer"><div class="post-tags"><a href="/tags/mariadb/" rel="tag"># mariadb</a> <a href="/tags/编译/" rel="tag"># 编译</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/posts/49414842/" rel="next" title="关于wordpress 更新时需要FTP 服务器账户密码 的解决方法"><i class="fa fa-chevron-left"></i> 关于wordpress 更新时需要FTP 服务器账户密码 的解决方法</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/posts/e3ac84e4/" rel="prev" title="Centos下配置安装javaWeb环境">Centos下配置安装javaWeb环境 <i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"></div></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">Table of Contents</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">Overview</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="https://lilis-hexo-blog.oss-cn-shenzhen.aliyuncs.com/head.png?x-oss-process=style/header" alt="小叽"><p class="site-author-name" itemprop="name">小叽</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">47</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/index.html"><span class="site-state-item-count">45</span> <span class="site-state-item-name">tags</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/l552121229" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a> </span><span class="links-of-author-item"><a href="mailto:552121229l@gmail.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i>E-Mail</a></span></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#源码安装CMake"><span class="nav-number">1.</span> <span class="nav-text">源码安装CMake</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-获取CMake源码包"><span class="nav-number">1.1.</span> <span class="nav-text">1.获取CMake源码包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-解压、编译、安装Cmake"><span class="nav-number">1.2.</span> <span class="nav-text">2.解压、编译、安装Cmake</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#备注"><span class="nav-number">1.3.</span> <span class="nav-text">备注</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#源码安装mariadb"><span class="nav-number">2.</span> <span class="nav-text">源码安装mariadb</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-获取源码包"><span class="nav-number">2.1.</span> <span class="nav-text">1.获取源码包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-编译环境准备"><span class="nav-number">2.2.</span> <span class="nav-text">2.编译环境准备</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-创建mysql用户"><span class="nav-number">2.3.</span> <span class="nav-text">3.创建mysql用户</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-编译安装MariaDB"><span class="nav-number">2.4.</span> <span class="nav-text">4.编译安装MariaDB</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-配置安装MariaDB"><span class="nav-number">2.5.</span> <span class="nav-text">5.配置安装MariaDB</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-mariadb配置文件创建及更改，没有模版"><span class="nav-number">2.6.</span> <span class="nav-text">6.mariadb配置文件创建及更改，没有模版</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-设置环境变量"><span class="nav-number">2.7.</span> <span class="nav-text">7.设置环境变量</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#加载环境变量："><span class="nav-number">2.7.1.</span> <span class="nav-text">加载环境变量：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-修改Mysql的root用户密码以及打开远程连接-可选"><span class="nav-number">2.8.</span> <span class="nav-text">8.修改Mysql的root用户密码以及打开远程连接(可选)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-我们使用MariaDB提供的安全设置脚本来进行数据库安全配置"><span class="nav-number">2.9.</span> <span class="nav-text">9.我们使用MariaDB提供的安全设置脚本来进行数据库安全配置</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#MariaDB提供了一些配置脚本在"><span class="nav-number">2.9.1.</span> <span class="nav-text">MariaDB提供了一些配置脚本在</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#备注-1"><span class="nav-number">2.10.</span> <span class="nav-text">备注</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#注意事项"><span class="nav-number">2.10.1.</span> <span class="nav-text">注意事项</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#编译选项"><span class="nav-number">2.10.2.</span> <span class="nav-text">编译选项</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#cmake编译指令介绍"><span class="nav-number">2.10.3.</span> <span class="nav-text">cmake编译指令介绍</span></a></li></ol></li></ol></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2019</span> <span class="with-love"><i class="fa fa-user"></i> </span><span class="author" itemprop="copyrightHolder">小叽</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-area-chart"></i> </span><span class="post-meta-item-text">Site words total count&#58;</span> <span title="Site words total count">46.8k</span></div><div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div><span class="post-meta-divider">|</span><div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script><script type="text/javascript">// Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });</script></body></html>